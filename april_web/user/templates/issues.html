{% extends 'base.html' %}
{% block page_title %}
    {% if workplace %}
    Личный кабинет
    {% else %}
    Последние заявки
    {% endif %}
{% endblock %}
{% block header %}
    {% if workplace %}
    <button onclick="index()">Главная</button>
    {% else %}
    <button onclick="workplace()">Все заявки</button>
    {% endif %}
{% endblock %}
{% block content %}
    {% if issues_count == 0 %}
        <span class="no-issues">Нет заявок.</span>
    {% else %}
        {% for i in last_issues %}
            <div class="issue">
                <span class="pet-name">{{ i.name }}</span>
                <span class="issue-status">
                    {% if i.status == 0 %}
                        Заявка создана
                    {% elif i.status == 1 %}
                        Обработка данных
                    {% else %}
                        Услуга оказана
                    {% endif %}
                </span>
                <img class="pet-photo" src="/issue/photo/{{ i.pet_photo }}"/>
                {% if i.status == 2 %}
                    <img class="result-photo" src="/issue/photo/{{ i.result_photo }}"/>
                {% endif %}
            </div>
        {% endfor %}
    {% endif %}
    {% if workplace %}
        <div id="create-issue">
            <label for="pet-name">Кличка питомца: </label>
            <input
                id="pet-name"
                name="name"
                type="text"
                minlength="{{ pet_name_min }}"
                maxlength="{{ pet_name_max }}"
                required/>
            <label for="pet-photo">Фото питомца:</label>
            <input
                id="pet-photo"
                name="photo"
                type="file"
                required/>
            <button onclick="create_issue()">Создать</button>
        </div>
    {% endif %}
{% endblock %}
{% block scripts %}
<script>
    function index() {
        document.location.href = "/"
    }

    function workplace() {
        document.location.href = "/user/"
    }

    function create_issue() {
        var form = new FormData()
        form.append("name", find("#pet-name").value)
        form.append("photo", find("#pet-photo").files[0])

        request("/issue/save", "POST", form, function(code, status, response) {
            if (code == 200) {
                dialog("Заявка создана")
                document.location.href = "/"
            } else {
                dialog("Ошибка в создании заявки")
            }
        })
    }
</script>
{% endblock %}